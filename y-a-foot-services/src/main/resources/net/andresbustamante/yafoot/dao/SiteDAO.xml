<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.andresbustamante.yafoot.dao.SiteDAO">
    <select id="chercherSitesPourJoueur" resultType="Site">
        SELECT
            sit.sit_id        AS id,
            sit.sit_nom       AS nom,
            sit.sit_adresse   AS adresse,
            sit.sit_telephone AS telephone
        FROM yafoot.t_site sit
            JOIN yafoot.t_match mat ON sit.sit_id = mat.mat_site_fk
            JOIN yafoot.t_joueur_match jma ON mat.mat_id = jma.jma_match_fk
        WHERE jma.jma_joueur_fk = #{joueur}
    </select>

    <select id="chercherSiteParId" resultType="Site">
        SELECT
            sit.sit_id        AS id,
            sit.sit_nom       AS nom,
            sit.sit_adresse   AS adresse,
            sit.sit_telephone AS telephone
        FROM yafoot.t_site sit
        WHERE sit.sit_id = #{id}
    </select>

    <insert id="creerSite" useGeneratedKeys="true">
        <selectKey keyProperty="site.id" resultType="int" order="BEFORE">
            SELECT NEXTVAL('yafoot.s_site') AS id;
        </selectKey>

        INSERT INTO yafoot.t_site (sit_id, sit_nom, sit_adresse, sit_telephone)
        VALUES (#{site.id}, #{site.nom}, #{site.adresse}, #{site.telephone})
    </insert>
</mapper>